#!/bin/bash

. /opt/ownsec/ITSEC-Install-Scripts-ORIG/001.functions/all-scripts.sh

GITREPO=https://github.com/rezasp/joomscan.git
BRANCH=master
GITREPOROOT=/opt/ITSEC/2.Vulnerability-Scanner/joomscan/rezasp/joomscan
GITCLONEDIR=/opt/ITSEC/2.Vulnerability-Scanner/joomscan/rezasp
EXECUTEABLE1=joomscan.pl
EXECUTEABLE2=joomscan
EXECUTEABLE2=joomscan.sh
DSKTPFLS=/opt/ownsec/ITSEC-Install-Scripts-ORIG/2.Vulnerability-Scanner/joomscan
DSKTPFLSDEST=/home/$USER/.local/share/applications/2.Vulnerability-Scanner/joomscan
DSKTPFL=joomscan.desktop
APTLSTDIR=/opt/ownsec/ITSEC-Install-Scripts-ORIG/2.Vulnerability-Scanner/joomscan

BANNER () {
	echo "${bold}
	     _  ___   ___  __  __ ____   ____    _    _   _ 
	    | |/ _ \ / _ \|  \/  / ___| / ___|  / \  | \ | |
	 _  | | | | | | | | |\/| \___ \| |     / _ \ |  \| |
	| |_| | |_| | |_| | |  | |___) | |___ / ___ \| |\  |
	 \___/ \___/ \___/|_|  |_|____/ \____/_/   \_\_| \_|
		     
	INSTALL 
	${normal}"
}
DEPS () {
	sudo apt-get update
	sudo apt-get upgrade
	xargs -a <(awk '/^\s*[^#]/' "$APTLSTDIR/deps-joomscan.txt") -r -- sudo apt-get install -y
}
PLEXEC () {

	echo '#!/bin/bash

	cd /opt/ITSEC/2.Vulnerability-Scanner/joomscan/rezasp/joomscan

	perl joomscan.pl "$@"' > $EXECUTEABLE3
	chmod +x $EXECUTEABLE1
	chmod +x $EXECUTEABLE3
}

BANNER
GITCLONEFUNC
DEPS
GITSBMDLINIT
PLEXEC
sudo ln -s $GITREPOROOT/$EXECUTEABLE3 $BINDIR/$EXECUTEABLE2
CPDESKTFL
