#!/bin/bash

#1i
. /opt/ownsec/ITSEC-Install-Scripts-ORIG/001.functions/all-scripts.sh

GITREPO=https://github.com/zaproxy/zaproxy.git
BRANCH=develop
GITREPOROOT=/opt/ITSEC/2.Vulnerability-Scanner/zaproxy/zaproxy/zaproxy
GITCLONEDIR=/opt/ITSEC/2.Vulnerability-Scanner/zaproxy/zaproxy
EXECUTEABLE1=zaproxy.sh
EXECUTEABLE2=zaproxy
EXECUTEABLE3=zap-dev.jar
EXECUTEABLE_PATH=/opt/ITSEC/2.Vulnerability-Scanner/zaproxy/zaproxy/zaproxy/build/zaproxd-bin
PATHNAME1=zaproxd-bin
#ph1b
DSKTPFLS=/opt/ownsec/ITSEC-Install-Scripts-ORIG/2.Vulnerability-Scanner/zaproxy
DSKTPFLSDEST=/home/$USER/.local/share/applications/2.Vulnerability-Scanner/zaproxy
DSKTPFL=zaproxy.desktop
APTLSTDIR=/opt/ownsec/ITSEC-Install-Scripts-ORIG/2.Vulnerability-Scanner/zaproxy

BANNER () {
	echo "${bold}
	 _____   _    ____  ____   _____  ____   __
	|__  /  / \  |  _ \|  _ \ / _ \ \/ /\ \ / /
	  / /  / _ \ | |_) | |_) | | | \  /  \ V / 
	 / /_ / ___ \|  __/|  _ <| |_| /  \   | |  
	/____/_/   \_\_|   |_| \_\\___/_/\_\  |_|  
		 
	INSTALL    
	${normal}"
}



DEPS () {
	sudo apt-get update
	sudo apt-get upgrade
	xargs -a <(awk '/^\s*[^#]/' "$APTLSTDIR/deps-zaproxy.txt") -r -- sudo apt-get install -y
	### DEPS:
	# JAVA installed part 2 
	# /opt/ownsec/0.Initial/src/PT2/6.Java-JDK-JRE.sh
	### DEPS END
}
BUILD () {
	cd build
	ant -d
	tar -vxf ZAP_Dev\ Build_Linux.tar.gz
	cp -r ZAP_Dev\ Build $PATHNAME1
	sudo rm -R ZAP_DEV\ Build
}
JAREXEC () {

	echo '#!/bin/bash 
	cd /opt/ITSEC/2.Vulnerability-Scanner/zaproxy/zaproxy/zaproxy/build/zaproxd-bin 
	java -jar zap-dev.jar "$@"' > $EXECUTEABLE_PATH/$EXECUTEABLE1
	chmod +x $EXECUTEABLE_PATH/$EXECUTEABLE1
	chmod +x $EXECUTEABLE_PATH/$EXECUTEABLE3
}


BANNER
DEPS
GITCLONEFUNC
GITSBMDLINIT
BUILD
JAREXEC
sudo ln -s $EXECUTEABLE_PATH/$EXECUTEABLE1 $BINDIR/$EXECUTEABLE2
CPDESKTFL

